?poly2nb
# Load packages
library(sf)
library(mapview)
library(spdep)
library(igraph)
edges <- get.edgelist(cuencas_mat)
my_graph <- graph.adjacency(x)
edges <- get.edgelist(my_graph)
my_graph <- graph.adjacency(cuencas_mat)
edges <- get.edgelist(my_graph)
View(edges)
View(cuencas)
# Load packages
library(sf)
library(mapview)
library(spdep)
library(igraph)
# data
district_outlines <- st_read("raw_data/vtds_22p/VTDs_22P.shp")
# display data
mapview(district_outlines)
# estimate first order adjacency matrix
district_adjacency_mat <- nb2mat(poly2nb(district_outlines), style = "B")
district_adjacency_mat[1:10, 1:10]
district_graph <- graph.adjacency(district_adjacency_mat)
district_edge_list <- get.edgelist(district_graph)
save(district_edge_list, file = "district_edge_list.Rdata")
load("C:/dev/git/Gerrymander/district_edge_list.Rdata")
write.csv(district_edge_list, file = "district_edge_list.csv")
election_raw <- read.csv("2020_general_election_data/president.csv")
View(election_raw)
election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
View(voter_reg_raw)
View(election_raw)
election <-
election_raw %>%
select(VDTKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
left_join(voter_reg_raw, by = c("VDTKEY" = "VDTKEY"))
election <-
election_raw %>%
select(VDTKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President)
library(tidyverse)
election <-
election_raw %>%
select(VDTKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President)
election <-
election_raw %>%
select(VDTKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President)
election <-
election_raw %>%
select(VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President)
View(election)
election <-
election_raw %>%
select(VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
left_join(voter_reg_raw, by = c("VTDKEY" = "VTDKEY"))
View(election)
election <-
election_raw %>%
select(VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
left_join(voter_reg_raw %>% select(VTDKEY, Voter_Registration, Turnout), by = c("VTDKEY" = "VTDKEY"))
View(election)
election <-
election_raw %>%
select(VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
left_join(
voter_reg_raw %>%
select(VTDKEY, Voter_Registration, Turnout),
by = c("VTDKEY" = "VTDKEY")
)
View(election)
# Load packages
library(sf)
library(mapview)
library(spdep)
library(igraph)
# data
district_outlines <- st_read("raw_data/vtds20g_2020/VTDs20G_2020.shp")
# display data
mapview(district_outlines)
# estimate first order adjacency matrix
district_adjacency_mat <- nb2mat(poly2nb(district_outlines), style = "B")
district_graph <- graph.adjacency(district_adjacency_mat)
district_edge_list <- get.edgelist(district_graph)
write.csv(district_edge_list, file = "district_edge_list.csv")
election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
left_join(
voter_reg_raw %>%
select(VTDKEY, Voter_Registration, Turnout),
by = c("VTDKEY" = "VTDKEY")
) %>%
left_join(
voter_pop_raw %>%
select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
by = c("VTDKEY" = "VTDKEY")
)
View(election_raw)
# Load packages
library(sf)
library(mapview)
library(spdep)
library(igraph)
# data
# district_outlines <- st_read("raw_data/vtds20g_2020/VTDs20G_2020.shp")
# district_outlines <- st_read("raw_data/vtd_20g_new1/VTD20G.shp")
district_outlines <- st_read("raw_data/vtds_22p/VTDs_22P.shp")
# display data
mapview(district_outlines)
# estimate first order adjacency matrix
district_adjacency_mat <- nb2mat(poly2nb(district_outlines), style = "B")
district_graph <- graph.adjacency(district_adjacency_mat)
district_edge_list <- get.edgelist(district_graph)
write.csv(district_edge_list, file = "district_edge_list.csv")
View(district_outlines)
election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
by = c("CNTYVTD" = "CNTYVTD")
# by = c("VTDKEY" = "VTDKEY")
)
library(tidyverse)
election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
by = c("CNTYVTD" = "CNTYVTD")
# by = c("VTDKEY" = "VTDKEY")
)
save(election, file = "election_data.Rdata")
write.csv(election, file = "district_demographics.csv")
library(tidyverse)
# load("election_data.Rdata")
biden_trump_sum <-
election %>%
select(CNTYVTD, vap, Biden, Trump) %>%
na.omit(vap) %>%
mutate(Biden_Trump_sum = Biden + Trump, .keep = "unused") %>%
mutate(vap_turnout = Biden_Trump_sum / vap) %>%
arrange(desc(vap_turnout))
View(biden_trump_sum)
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
save(election, file = "election_data.Rdata")
write.csv(election, file = "district_demographics.csv")
biden_trump_sum <-
election %>%
select(CNTYVTD, vap, Biden, Trump) %>%
na.omit(vap) %>%
mutate(Biden_Trump_sum = Biden + Trump, .keep = "unused") %>%
mutate(vap_turnout = Biden_Trump_sum / vap) %>%
arrange(desc(vap_turnout))
biden_trump_sum <-
election %>%
# select(CNTYVTD, vap, Biden, Trump) %>%
select(VTDKEY, vap, Biden, Trump) %>%
na.omit(vap) %>%
mutate(Biden_Trump_sum = Biden + Trump, .keep = "unused") %>%
mutate(vap_turnout = Biden_Trump_sum / vap) %>%
arrange(desc(vap_turnout))
View(biden_trump_sum)
election %>%
# filter(VTDKEY.x < 2500, VTDKEY.x > 2000) %>%
ggplot() +
geom_point(mapping = aes(x = VTDKEY.x, y = VTDKEY.y), color = "blue") +
geom_point(mapping = aes(x = VTDKEY.x, y = VTDKEY.x), color = "red")
View(district_edge_list)
View(election)
View(election)
# election_raw <- read.csv("2020_general_election_data/president.csv")
# voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
save(election, file = "election_data.Rdata")
write.csv(election, file = "district_demographics.csv")
# election_raw <- read.csv("2020_general_election_data/president.csv")
voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
# voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
election_raw <- read.csv("2020_general_election_data/president.csv")
# voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
# voter_pop_raw <- read.csv("2020_general_election_data/vtds20g_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
election_raw <- read.csv("2020_general_election_data/president.csv")
# voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds22p_pop.txt")
election_raw <- read.csv("2020_general_election_data/president.csv")
# voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds_22p_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
save(election, file = "election_data.Rdata")
write.csv(election, file = "district_demographics.csv")
View(election)
biden_trump_sum <-
election %>%
# select(CNTYVTD, vap, Biden, Trump) %>%
select(VTDKEY, vap, Biden, Trump) %>%
na.omit(vap) %>%
mutate(Biden_Trump_sum = Biden + Trump, .keep = "unused") %>%
mutate(vap_turnout = Biden_Trump_sum / vap) %>%
arrange(desc(vap_turnout))
View(biden_trump_sum)
View(election)
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
election_raw <- read.csv("2020_general_election_data/president.csv")
# voter_reg_raw <- read.csv("2020_general_election_data/voter data.csv")
voter_pop_raw <- read.csv("2020_general_election_data/vtds_22p_pop.txt")
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
# mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
# na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME) %>%
# mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
# na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
election <-
election_raw %>%
select(CNTYVTD, VTDKEY, Biden = BidenD_20G_President, Trump = TrumpR_20G_President) %>%
# mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
# na.omit() %>%
# left_join(
#   voter_reg_raw %>%
#     select(VTDKEY, Voter_Registration, Turnout),
#   by = c("VTDKEY" = "VTDKEY")
# ) %>%
# left_join(
#   voter_pop_raw %>%
#     select(VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),
#   by = c("VTDKEY" = "VTDKEY")
# )
left_join(
voter_pop_raw %>%
select(CNTYVTD, VTDKEY, VTD, vap, anglovap, nanglovap, FENAME),# %>%
# mutate(CNTYVTD = as.numeric(CNTYVTD)) %>%
# na.omit(CNTYVTD),
# by = c("CNTYVTD" = "CNTYVTD")
by = c("VTDKEY" = "VTDKEY")
)
biden_trump_sum <-
election %>%
# select(CNTYVTD, vap, Biden, Trump) %>%
select(VTDKEY, vap, Biden, Trump) %>%
na.omit(vap) %>%
mutate(Biden_Trump_sum = Biden + Trump, .keep = "unused") %>%
mutate(vap_turnout = Biden_Trump_sum / vap) %>%
arrange(desc(vap_turnout))
biden_trump_sum %>%
na.omit(vap) %>%
filter(vap_turnout > 1)
election %>%
# filter(VTDKEY.x < 2500, VTDKEY.x > 2000) %>%
ggplot() +
geom_point(mapping = aes(x = VTDKEY.x, y = VTDKEY.y), color = "blue") +
geom_point(mapping = aes(x = VTDKEY.x, y = VTDKEY.x), color = "red")
election %>%
ggplot() +
geom_point(mapping = aes(x = CNTYVTD.x, y = CNTYVTD.y), color = "blue") +
geom_point(mapping = aes(x = CNTYVTD.x, y = CNTYVTD.x), color = "red")
View(election)
# knitr options
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
mpg %>%
ggplot(mapping = aes(x = trans)) +
geom_bar()
mpg %>%
count(trans) %>%
ggplot(mapping = aes(x = trans, y = n)) +
geom_col()
## NOTE: Run this chunk for an illustration
mpg %>% filter(cty == 20)
mpg %>%
ggplot(mapping = aes(x = cty, y = hwy, fill = hwy)) +
geom_col(position = "dodge") +
geom_point()
## NOTE: Run this chunk for an illustration
mpg %>%
ggplot(aes(cty, hwy)) +
geom_point()
## TODO: Run this code without changing, describe your observations on the data
mpg %>%
ggplot(aes(class, fill = class)) +
geom_bar()
## TODO: Run this code without changing, describe your observations on the data
mpg %>%
ggplot(aes(class, fill = drv)) +
geom_bar()
mpg %>%
ggplot(aes(x = manufacturer, fill = class)) +
geom_bar(position = "stack") +
theme(axis.text.x = element_text(angle = 270, vjust = 0.5, hjust = 0))
mpg %>%
ggplot(aes(x = cyl)) +
geom_bar() +
facet_wrap(~ manufacturer)
